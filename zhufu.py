import streamlit as st
import random
import datetime

def generate_positive_fortune():
    """生成一个积极的运势描述，并加上特定前缀"""
    positive_fortunes = [
        # --- 通用好运 & 综合运势 ---
        "今天，幸运女神将格外眷顾你，一切都将顺心如意！",
        "诸事皆宜，心情舒畅，今天是心想事成的一天！",
        "遇到困难时总有贵人相助，逢凶化吉，一切顺利！",
        "好运正在向你狂奔而来，请做好接收准备！",
        "今天的你自带光芒，无论走到哪里都是焦点！",
        "霉运退散，好运连连，今天会发生一件让你开心很久的事！",
        "你的直觉今天超级准，跟着感觉走绝对没错！",
        "天时地利人和，今天适合做任何你想做的决定！",
        "惊喜会在不经意间出现，保持期待吧！",
        "宇宙接收到了你的愿望，正在悄悄为你安排好一切！",
        "今天是你运气爆棚的一天，适合买张彩票试试手气！",
        "烦恼会自动绕道走，快乐会主动找上门！",
        "今天的幸运色是你的心情色，怎么穿都好看，怎么做都对！",
        "大事化小，小事化了，今天的世界对你格外温柔！",
        "你的笑容是今天的通行证，能为你打开所有大门！",
        "今天适合许愿，因为实现的概率非常高！",
        "生活明朗，万物可爱，你也按时长大，今日宜开心！",
        "以前的努力会在今天看到回报，哪怕是一点点小确幸！",
        "今天会听到一个好消息，让你嘴角疯狂上扬！",
        "出门遇贵人，在家听喜讯，总之就是顺！",

        # --- 事业 & 学业 & 灵感 ---
        "事业运高涨，工作效率倍增，难题迎刃而解！",
        "学业或事业上会有突破性进展，灵感源源不断！",
        "创意无限，是发挥才能、展现独特想法的好日子！",
        "今天适合整理思绪，做出重要规划，会发现前路豁然开朗！",
        "你的才华藏不住了，今天会被重要的人赏识！",
        "即使是棘手的工作，今天也能像切豆腐一样轻松搞定！",
        "沟通能力满分，今天的会议或谈判将异常顺利！",
        "学习力爆棚，看书过目不忘，理解力各种Max！",
        "一个困扰你很久的问题，今天会突然找到完美的解决方案！",
        "你的努力被看在眼里，升职加薪的机会正在酝酿中！",
        "今天适合开启新的项目或学习新技能，上手速度极快！",
        "同事或同学会成为你的神助攻，团队合作如有神助！",
        "不论考试还是考核，今天的你都能超常发挥！",
        "你的专业度让人折服，今天会收获一波迷弟迷妹！",
        "灵感像喷泉一样涌出来，快拿小本本记下来！",
        "拖延症痊愈的一天，行动力满分，任务清单全勾掉！",
        "今天在工作中会得到一个非常关键的指点！",
        "你的领导力今日凸显，大家都会愿意听从你的建议！",
        "不管是写代码还是写文章，今天都没有Bug，只有流畅！",
        "职业倦怠期结束，今天重新找回了奋斗的热情！",

        # --- 财富 & 搞钱 ---
        "财运亨通，意外之喜可能降临，小投入大回报！",
        "钱包鼓鼓，今天可能会有一笔意想不到的收入！",
        "今天你的理财直觉很准，由于你的决策，未来收益可期！",
        "购物运极佳，能买到物超所值的心头好！",
        "也许是在旧衣服里发现钱，也许是抢到大红包，小财运不断！",
        "今天适合做一点小投资，或者规划一下财务自由的路径！",
        "该省的钱省下了，该赚的钱赚到了，这就是完美的一天！",
        "之前的投资今天开始见效了，账户数字让人开心！",
        "今天如果有人请客吃饭，千万不要拒绝，那是好运的开始！",
        "财神爷今天在你家门口路过，顺手给你留了点好运气！",
        "可能会收到一份价值不菲的礼物，或者现金红包！",
        "你的搞钱雷达今天特别灵敏，能发现别人看不到的商机！",
        "不仅正财稳，偏财也旺，今天手气好到爆！",
        "原本觉得贵的那个东西，今天可能会打折或者送赠品！",
        "今天出门记得看脚下，没准能捡到钱（或者捡到宝）！",

        # --- 爱情 & 人际 & 魅力 ---
        "你的魅力值今日飙升，人际关系和谐，贵人运极佳！",
        "爱情运甜蜜升温，和心爱的人关系更进一步！",
         "友情升华，与朋友们共同创造美好回忆，感受温暖与支持！",
        "今天你就像一块磁铁，吸引来的都是友善和喜爱！",
        "如果有误会，今天是最适合冰释前嫌的日子！",
        "你的声音和笑容今天特别有感染力，谁见了都喜欢！",      
        "和老朋友联系一下吧，会有意想不到的惊喜和感动！",      
        "你今天的穿搭会被夸奖很多次，自信心爆棚！",
        "在社交场合游刃有余，你就是今天的Social King/Queen！",      
        "家人之间的氛围格外温馨，是享受天伦之乐的好日子！",
        "今天你的情商在线，一句话就能把尴尬化为欢笑！",

        # --- 健康 & 心情 & 状态 ---
        "健康活力充沛，精神饱满，是开启新挑战的好时机！",
        "心情愉悦，充满正能量，周围的人都会被你感染！",
        "内心平静，充满智慧，今日的每一个决定都将是明智之举！",
        "昨晚睡得好，今天皮肤好，状态好，一切都好！",
        "胃口棒棒，吃嘛嘛香，而且怎么吃都不会胖（心理上）！",
        "运动能力提升，今天的锻炼效果事半功倍！",
        "所有的疲惫一扫而空，感觉身体轻盈得像在飞！",
        "今天你的免疫力超强，百毒不侵！",
        "心情像雨后的彩虹一样美丽，没有任何阴霾！",
        "深呼吸，今天空气里都是自由和快乐的味道！",
        "今天适合做个SPA或者泡个澡，身心彻底放松！",
        "你的眼神清澈明亮，透着一股机灵劲儿！",
        "焦虑情绪今天放假了，你的脑子里只有轻松和愉快！",
        "今天走在路上都觉得脚下生风，活力四射！",
        "身体的某个小毛病，今天可能会突然感觉好多了！",

        # --- 生活小确幸 ---
        "小幸运不断，可能会收到意想不到的礼物或好消息！",
        "今日宜大胆尝试新事物，会有意想不到的收获和惊喜！",
        "旅行运佳，即使是短途出行也能收获美好体验和放松心情！",
        "出门就能赶上公交车/地铁，红绿灯一路绿灯！",
        "想吃的那个餐厅今天居然不用排队！",
        "点外卖可能会被加量，或者送好喝的饮料！",
        "天气预报说有雨，但你出门的时候刚好停了！",
        "手机电量一直很足，WiFi信号一直满格！",
        "随手拍的照片都能出大片，朋友圈点赞数创新高！",
        "不管是追剧还是看小说，今天都能看到超级精彩的情节！",
        "家里的小宠物今天格外粘人可爱，治愈力满分！",
        "洗衣服的时候发现口袋里不仅没落下纸巾，还有零钱！",
        "快递比预期提前送达，拆包裹的快乐加倍！",
        "听到一首特别好听的新歌，单曲循环一整天！",
        "今天做饭/点餐绝对不会踩雷，每一口都是美味！"
    ]
    
    selected_fortune = random.choice(positive_fortunes)
    return f"贾大仙觉得--{selected_fortune}"

def main():
    st.set_page_config(
        page_title="每日好运势 ✨",
        page_icon="🍀",
        layout="centered"
    )

    st.title("💖 贾大仙的运势计算器V1 ✨")
    st.write("---")

    # 获取今天的日期
    today = datetime.date.today()
    today_str = today.strftime("%Y-%m-%d")

    # --- 数据初始化逻辑 ---
    
    # 1. 如果今天还没有生成运势，先在后台生成好（但暂时不显示）
    if f"fortune_for_{today_str}" not in st.session_state:
        st.session_state[f"fortune_for_{today_str}"] = generate_positive_fortune()
        st.session_state["last_draw_date"] = today_str
        # 新增一个状态：记录今天是否已经点击了“揭晓”按钮
        st.session_state["is_revealed"] = False 

    # 2. 如果跨天了（日期变了），重置数据和揭晓状态
    if st.session_state.get("last_draw_date") != today_str:
        st.session_state[f"fortune_for_{today_str}"] = generate_positive_fortune()
        st.session_state["last_draw_date"] = today_str
        st.session_state["is_revealed"] = False # 新的一天，重置为未揭晓状态

    # --- 界面显示逻辑 ---

    st.markdown(
        """
        ### 亲爱的晓晗，愿你的每一天都充满阳光和好运！
        """
    )

    # 判断：如果还没有揭晓（is_revealed 为 False），显示“抽取按钮”
    if not st.session_state.get("is_revealed", False):
        st.info(f"今天是 {today_str}，贾大仙为你准备了一份专属好运，准备好了吗？")
        
        # 创建一个占位容器，居中显示按钮
        col1, col2, col3 = st.columns([1, 2, 1])
        with col2:
            # 点击按钮后
            if st.button("✨ 点击揭晓今日运势 ✨", type="primary", use_container_width=True):
                # 修改状态为“已揭晓”
                st.session_state["is_revealed"] = True
                # 强制刷新页面，立刻显示运势结果
                st.rerun()

    # 判断：如果已经揭晓（is_revealed 为 True），显示“运势卡片”
    else:
        st.subheader(f"🗓️ {today_str} 的专属好运势：")
        
        # 显示带有动画效果的运势框
        with st.container():
            st.markdown(
                f"<div style='background-color:#E8F8F5; padding: 20px; border-radius: 10px; border: 2px solid #2ECC71; text-align: center; font-size: 24px; color: #2C3E50; font-weight: bold; box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);'>"
                f"{st.session_state[f'fortune_for_{today_str}']}"
                f"</div>",
                unsafe_allow_html=True
            )
        
        st.write("") # 加点空隙
        
        # 只有在揭晓后，才显示底部的祝福和分享按钮
        st.markdown(
            """
            <p style='text-align: center; font-style: italic; color: #888;'>
            贾大仙祝你拥有美好的一天！
            </p>
            """,
            unsafe_allow_html=True
        )

        if st.button("🎉 谢谢贾大仙！", help="点击领取祝福"):
            st.balloons()

if __name__ == "__main__":
    main()

